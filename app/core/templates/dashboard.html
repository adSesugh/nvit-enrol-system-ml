{% extends 'base.html' %}

{% block title %} Dashboard {% endblock %}

{% block content %}
    <div class="row">
        <div class="col-sm-12 mb-4 mb-xl-0">
            <h4 class="font-weight-bold text-dark">Hi, welcome back!</h4>
            <p class="font-weight-normal mb-2 text-muted">{{ current_user.full_name }}</p>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-xl-5 flex-column d-flex grid-margin">
            <div class="row grid-margin">
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Applications</h4>
                            <h4 class="text-dark font-weight-bold mb-2">1615</h4>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Expected</h4>
                            <h4 class="text-dark font-weight-bold mb-2">860</h4>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row grid-margin">
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Captured</h4>
                            <h4 class="text-dark font-weight-bold mb-2">{{ records.captured }}</h4>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Available Courses</h4>
                            <h4 class="text-dark font-weight-bold mb-2">6</h4>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row grid-margin">
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Female Admitted</h4>
                            <table style="width: '100%'" class="table d-lg-table">
                                <tr>
                                    <th>Status</th>
                                    <td>Count</td>
                                </tr>
                                <tr>
                                    <th>PWD</th>
                                    <td>{{ records.female_disabled }}</td>
                                </tr>
                                <tr>
                                    <th>Normal</th>
                                    <td>{{ records.female_count - records.female_disabled }}</td>
                                </tr>
                                <tr>
                                    <th>Total</th>
                                    <th>{{ records.female_count }}</th>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Male Admitted</h4>
                            <table style="width: '100%'" class="table d-lg-table">
                                <tr>
                                    <th>Status</th>
                                    <td>Count</td>
                                </tr>
                                <tr>
                                    <th>PWD</th>
                                    <td>{{ records.male_disabled }}</td>
                                </tr>
                                <tr>
                                    <th>Normal</th>
                                    <td>{{ records.male_count - records.male_disabled }}</td>
                                </tr>
                                <tr>
                                    <th>Total</th>
                                    <th>{{ records.male_count }}</th>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-7 d-flex flex-column grid-margin stretch-card">
            <div class="card mb-3">
              <div class="card-body">
                  <h4 class="card-title">Applicant distribution against courses</h4>
                  <div class="row">
                      <div class="col-sm-12">
                          <canvas id="coursesChart" height="200" class="mt-3"></canvas>
                      </div>
                  </div>
                    <div class="row my-2">
                        <div class="card-header mt-2">
                            <h4 class="card-title mb-1">Code Description</h4>
                        </div>
                        <div class="row">
                            {% for (index, code) in enumerate(records.stats.labels) %}
                                <div class="col-12 my-1 card-text" style="font-size: 12px;">{{ code }} - {{ records.stats.courses[index] }}</div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
              </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script>
        const ctx = document.getElementById('coursesChart');
        const ctx_disabled = document.getElementById('femaleMaleChart');
        var labels = {{ records.stats.labels|tojson }};
        var course_data = {{ records.stats.data|tojson }};

        new Chart(ctx, {
            type: 'bar',
            data: {
              labels: labels,
              datasets: [{
                label: 'Applicants per course',
                data: course_data,
                borderWidth: 1,
                minBarLength: 2,
              }]
            },
            options: {
                scales: {
                    y: {
                    beginAtZero: true,
                        grid: {
                            display: false
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                indexAxis: 'y',
                plugins: {
                    datalabels: {
                        formatter: function(value, context) {
                            return context.chart.data.labels[context.dataIndex];
                        }
                    }
                }
            }
        });
    </script>
{% endblock %}